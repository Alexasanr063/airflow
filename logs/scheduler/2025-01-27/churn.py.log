[2025-01-27T19:46:10.409+0000] {processor.py:186} INFO - Started process (PID=67) to work on /opt/airflow/dags/churn.py
[2025-01-27T19:46:10.410+0000] {processor.py:914} INFO - Processing file /opt/airflow/dags/churn.py for tasks to queue
[2025-01-27T19:46:10.415+0000] {logging_mixin.py:190} INFO - [2025-01-27T19:46:10.414+0000] {dagbag.py:588} INFO - Filling up the DagBag from /opt/airflow/dags/churn.py
[2025-01-27T19:46:10.458+0000] {logging_mixin.py:190} INFO - [2025-01-27T19:46:10.458+0000] {base.py:84} INFO - Retrieving connection 'destination_db'
[2025-01-27T19:46:10.459+0000] {logging_mixin.py:190} INFO - [2025-01-27T19:46:10.459+0000] {sql.py:186} WARNING - This setter is for backward compatibility and should not be used.
Since the introduction of connection property, the providers listed below breaks due to assigning value to self.connection in their __init__ method.
* apache-airflow-providers-mysql<5.7.1
* apache-airflow-providers-elasticsearch<5.5.1
* apache-airflow-providers-postgres<5.13.0
[2025-01-27T19:46:10.463+0000] {logging_mixin.py:190} INFO - [2025-01-27T19:46:10.463+0000] {base.py:84} INFO - Retrieving connection 'destination_db'
[2025-01-27T19:46:11.288+0000] {logging_mixin.py:190} INFO - [2025-01-27T19:46:11.288+0000] {churn.py:58} INFO - Создание таблицы users_churn.
[2025-01-27T19:46:11.513+0000] {logging_mixin.py:190} INFO - [2025-01-27T19:46:11.499+0000] {dagbag.py:387} ERROR - Failed to import: /opt/airflow/dags/churn.py
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DuplicateTable: relation "unique_customer_constraint" already exists


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.10/site-packages/airflow/models/dagbag.py", line 383, in parse
    loader.exec_module(new_module)
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/opt/airflow/dags/churn.py", line 124, in <module>
    prepare_churn_dataset()
  File "/home/airflow/.local/lib/python3.10/site-packages/airflow/models/dag.py", line 4307, in factory
    f(**f_kwargs)
  File "/opt/airflow/dags/churn.py", line 115, in prepare_churn_dataset
    create_table()  # Вызов функции для создания таблицы
  File "/opt/airflow/dags/churn.py", line 59, in create_table
    metadata.create_all(engine)
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/sql/schema.py", line 4930, in create_all
    bind._run_ddl_visitor(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3238, in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2221, in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 524, in traverse_single
    return meth(obj, **kw)
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/sql/ddl.py", line 855, in visit_metadata
    self.traverse_single(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 524, in traverse_single
    return meth(obj, **kw)
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/sql/ddl.py", line 899, in visit_table
    self.connection.execute(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/sql/ddl.py", line 80, in _execute_on_connection
    return connection._execute_ddl(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1477, in _execute_ddl
    ret = self._execute_context(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DuplicateTable) relation "unique_customer_constraint" already exists

[SQL: 
CREATE TABLE users_churn (
	id SERIAL NOT NULL, 
	customer_id VARCHAR NOT NULL, 
	begin_date TIMESTAMP WITHOUT TIME ZONE, 
	end_date TIMESTAMP WITHOUT TIME ZONE, 
	type VARCHAR, 
	paperless_billing VARCHAR, 
	payment_method VARCHAR, 
	monthly_charges FLOAT, 
	total_charges FLOAT, 
	internet_service VARCHAR, 
	online_security VARCHAR, 
	online_backup VARCHAR, 
	device_protection VARCHAR, 
	tech_support VARCHAR, 
	streaming_tv VARCHAR, 
	streaming_movies VARCHAR, 
	gender VARCHAR, 
	senior_citizen INTEGER, 
	partner VARCHAR, 
	dependents VARCHAR, 
	multiple_lines VARCHAR, 
	target INTEGER, 
	PRIMARY KEY (id), 
	CONSTRAINT unique_customer_constraint UNIQUE (customer_id)
)

]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2025-01-27T19:46:11.514+0000] {processor.py:927} WARNING - No viable dags retrieved from /opt/airflow/dags/churn.py
[2025-01-27T19:46:11.530+0000] {processor.py:208} INFO - Processing /opt/airflow/dags/churn.py took 1.129 seconds
